import{a as t,l as i}from"./utils-84166b5c.js";import{_ as e,n as s}from"./main-096a2968.js";import{o,c as a,d as n,t as h,g as r}from"./vendor-2ba4b4b0.js";const c={class:"game-container"},d=["width","height"],l={class:"game-ui"},u={class:"score-section"},g={class:"score-value"},f={class:"pause-icon"},m={key:0,class:"pause-overlay"},v={class:"pause-content"},x={key:1,class:"game-over-overlay"},p={class:"game-over-content"},y={class:"final-score"},b={class:"game-over-buttons"},w={key:2,class:"virtual-controls"},S={class:"control-pad"},k={class:"control-row"};const M=e({name:"GamePage",data:()=>({canvas:null,ctx:null,canvasWidth:800,canvasHeight:800,gameRunning:!1,isPaused:!1,gameOver:!1,score:0,gridSize:20,gameSpeed:350,snake:[{x:10,y:10},{x:9,y:10},{x:8,y:10}],direction:"right",nextDirection:"right",food:{x:15,y:15},foodAnimationSpeed:.001,foodEatAnimation:{active:!1,startTime:0,duration:100,scale:1,opacity:1},showVirtualKeys:!0,touchStartX:0,touchStartY:0,lastTime:0,gameLoop:null,particles:[],glitchEffect:!1}),computed:{gridWidth(){return Math.floor(this.canvasWidth/this.gridSize)},gridHeight(){return Math.floor(this.canvasHeight/this.gridSize)}},mounted(){console.log("🎮 Game page loaded"),t.resume(),this.initGame(),this.setupKeyboardControls(),window.setFoodAnimationSpeed=t=>this.setFoodAnimationSpeed(t),window.setFoodEatDuration=t=>this.setFoodEatDuration(t),console.log("🍎 Food animation controls available:"),console.log("  setFoodAnimationSpeed(0.001-0.02) - 调整食物旋转速度"),console.log("  setFoodEatDuration(100-1000) - 调整食物消失动画时长(ms)")},beforeUnmount(){this.stopGame(),this.removeKeyboardControls(),delete window.setFoodAnimationSpeed,delete window.setFoodEatDuration},methods:{navigateTo:s,initGame(){this.$nextTick(()=>{this.setupCanvas(),this.resetGame(),this.startGame()})},setupCanvas(){this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d");const t=.8*Math.min(window.innerWidth,window.innerHeight);this.canvasWidth=Math.min(t,600),this.canvasHeight=this.canvasWidth;const i=window.devicePixelRatio||1;this.canvas.width=this.canvasWidth*i,this.canvas.height=this.canvasHeight*i,this.canvas.style.width=this.canvasWidth+"px",this.canvas.style.height=this.canvasHeight+"px",this.ctx.scale(i,i),console.log("✅ Canvas setup completed:",this.canvasWidth+"x"+this.canvasHeight)},resetGame(){this.snake=[{x:10,y:10},{x:9,y:10},{x:8,y:10}],this.direction="right",this.nextDirection="right",this.score=0,this.gameOver=!1,this.isPaused=!1,this.generateFood(),this.particles=[],this.foodEatAnimation.active=!1,this.foodEatAnimation.scale=1,this.foodEatAnimation.opacity=1},startGame(){this.gameRunning=!0,this.lastTime=Date.now(),this.gameLoop=setInterval(this.update,this.gameSpeed),console.log("🎮 Game started")},stopGame(){this.gameRunning=!1,this.gameLoop&&(clearInterval(this.gameLoop),this.gameLoop=null)},update(){!this.gameRunning||this.isPaused||this.gameOver||(this.updateGame(),this.render())},updateGame(){this.direction=this.nextDirection,this.moveSnake(),this.checkCollisions(),this.updateParticles()},moveSnake(){const t={...this.snake[0]};switch(this.direction){case"up":t.y--;break;case"down":t.y++;break;case"left":t.x--;break;case"right":t.x++}this.snake.unshift(t),t.x===this.food.x&&t.y===this.food.y?this.eatFood():this.snake.pop()},eatFood(){this.score+=10,this.foodEatAnimation.active=!0,this.foodEatAnimation.startTime=Date.now(),this.foodEatAnimation.scale=1,this.foodEatAnimation.opacity=1,setTimeout(()=>{this.generateFood()},this.foodEatAnimation.duration),this.createEatEffect(),t.playEatSound(),this.score%50==0&&this.gameSpeed>80&&(this.gameSpeed-=10,this.stopGame(),this.startGame()),console.log("🍎 Food eaten! Score:",this.score)},generateFood(){let t;do{t={x:Math.floor(Math.random()*this.gridWidth),y:Math.floor(Math.random()*this.gridHeight)}}while(this.snake.some(i=>i.x===t.x&&i.y===t.y));this.food=t},checkCollisions(){const t=this.snake[0];if(t.x<0||t.x>=this.gridWidth||t.y<0||t.y>=this.gridHeight)this.endGame();else for(let i=1;i<this.snake.length;i++)if(t.x===this.snake[i].x&&t.y===this.snake[i].y)return void this.endGame()},endGame(){this.gameOver=!0,this.stopGame(),this.createGameOverEffect(),t.playGameOverSound();const e=i.addScore(this.score);i.isNewRecord(this.score)?(console.log("🏆 NEW HIGH SCORE!",this.score),alert("🏆 NEW HIGH SCORE!")):e<=10&&console.log(`📊 Ranked #${e} in leaderboard`),console.log("💀 Game Over! Final Score:",this.score)},render(){this.ctx&&(this.ctx.fillStyle="#001122",this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.drawGrid(),this.drawFood(),this.drawSnake(),this.drawParticles(),this.glitchEffect&&this.drawGlitch())},drawGrid(){this.ctx.strokeStyle="rgba(10, 255, 255, 0.1)",this.ctx.lineWidth=1;for(let t=0;t<=this.gridWidth;t++)this.ctx.beginPath(),this.ctx.moveTo(t*this.gridSize,0),this.ctx.lineTo(t*this.gridSize,this.canvasHeight),this.ctx.stroke();for(let t=0;t<=this.gridHeight;t++)this.ctx.beginPath(),this.ctx.moveTo(0,t*this.gridSize),this.ctx.lineTo(this.canvasWidth,t*this.gridSize),this.ctx.stroke()},drawSnake(){this.snake.forEach((t,i)=>{const e=t.x*this.gridSize,s=t.y*this.gridSize;if(0===i)this.ctx.fillStyle="#0affff",this.ctx.shadowColor="#0affff",this.ctx.shadowBlur=15,this.ctx.fillRect(e+2,s+2,this.gridSize-4,this.gridSize-4),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(e+6,s+6,this.gridSize-12,this.gridSize-12);else{const t=1-i/this.snake.length*.5;this.ctx.fillStyle=`rgba(10, 255, 255, ${t})`,this.ctx.shadowColor="#0affff",this.ctx.shadowBlur=10,this.ctx.fillRect(e+1,s+1,this.gridSize-2,this.gridSize-2)}}),this.ctx.shadowBlur=0},drawFood(){const t=this.food.x*this.gridSize,i=this.food.y*this.gridSize,e=t+this.gridSize/2,s=i+this.gridSize/2,o=Date.now()*this.foodAnimationSpeed;let a=1,n=1;if(this.foodEatAnimation.active){const t=Date.now()-this.foodEatAnimation.startTime,i=Math.min(t/this.foodEatAnimation.duration,1);if(a=i<.3?1+i/.3*.5:1.5-(i-.3)/.7*1.5,n=1-i,i>=1)return void(this.foodEatAnimation.active=!1)}this.ctx.save(),this.ctx.translate(e,s),this.ctx.rotate(o),this.ctx.scale(a,a),this.ctx.globalAlpha=n,this.ctx.fillStyle="#ff00ff",this.ctx.shadowColor="#ff00ff",this.ctx.shadowBlur=20,this.ctx.fillRect(-8,-8,16,16),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(-6,-6,12,12),this.ctx.strokeStyle="#ff00ff",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(-4,0),this.ctx.lineTo(4,0),this.ctx.moveTo(0,-4),this.ctx.lineTo(0,4),this.ctx.stroke(),this.ctx.restore(),this.ctx.shadowBlur=0},onTouchStart(t){const i=t.touches[0];this.touchStartX=i.clientX,this.touchStartY=i.clientY},onTouchMove(t){t.preventDefault()},onTouchEnd(t){if(!this.gameRunning||this.isPaused||this.gameOver)return;const i=t.changedTouches[0],e=i.clientX-this.touchStartX,s=i.clientY-this.touchStartY;Math.abs(e)>Math.abs(s)?Math.abs(e)>30&&(e>0&&"left"!==this.direction?this.nextDirection="right":e<0&&"right"!==this.direction&&(this.nextDirection="left")):Math.abs(s)>30&&(s>0&&"up"!==this.direction?this.nextDirection="down":s<0&&"down"!==this.direction&&(this.nextDirection="up"))},onMouseDown(t){this.touchStartX=t.clientX,this.touchStartY=t.clientY},onMouseMove(t){t.preventDefault()},onMouseUp(t){if(!this.gameRunning||this.isPaused||this.gameOver)return;const i=t.clientX-this.touchStartX,e=t.clientY-this.touchStartY;Math.abs(i)>Math.abs(e)?Math.abs(i)>30&&(i>0&&"left"!==this.direction?this.nextDirection="right":i<0&&"right"!==this.direction&&(this.nextDirection="left")):Math.abs(e)>30&&(e>0&&"up"!==this.direction?this.nextDirection="down":e<0&&"down"!==this.direction&&(this.nextDirection="up"))},changeDirection(t){if(!this.gameRunning||this.isPaused||this.gameOver)return;this.direction!=={up:"down",down:"up",left:"right",right:"left"}[t]&&(this.nextDirection=t)},togglePause(){this.isPaused=!this.isPaused,console.log(this.isPaused?"⏸ Game paused":"▶ Game resumed")},restartGame(){this.stopGame(),this.resetGame(),this.startGame()},backToMenu(){this.stopGame(),this.navigateTo("index")},shareScore(){const t=`我在CyberSnake中获得了${this.score}分！\nI AM THE SYSTEM`;navigator.share?navigator.share({title:"CyberSnake Score",text:t,url:window.location.href}).catch(t=>console.log("Share failed:",t)):navigator.clipboard.writeText(t+"\n"+window.location.href).then(()=>alert("分数已复制到剪贴板！")).catch(()=>alert(`我的分数：${this.score}分`))},createEatEffect(){const t=this.food.x*this.gridSize+this.gridSize/2,i=this.food.y*this.gridSize+this.gridSize/2;for(let e=0;e<8;e++)this.particles.push({x:t,y:i,vx:10*(Math.random()-.5),vy:10*(Math.random()-.5),life:1,decay:.02,color:"#ff00ff",size:3+3*Math.random()});this.glitchEffect=!0,setTimeout(()=>{this.glitchEffect=!1},100)},createGameOverEffect(){for(let t=0;t<20;t++)this.particles.push({x:Math.random()*this.canvasWidth,y:Math.random()*this.canvasHeight,vx:15*(Math.random()-.5),vy:15*(Math.random()-.5),life:1,decay:.01,color:Math.random()>.5?"#0affff":"#ff00ff",size:4+6*Math.random()})},updateParticles(){this.particles=this.particles.filter(t=>(t.x+=t.vx,t.y+=t.vy,t.life-=t.decay,t.vx*=.98,t.vy*=.98,t.life>0))},drawParticles(){this.particles.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=t.life,this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill(),this.ctx.restore()})},drawGlitch(){for(let t=0;t<5;t++)this.ctx.fillStyle="rgba(255, 0, 255, 0.1)",this.ctx.fillRect(Math.random()*this.canvasWidth,Math.random()*this.canvasHeight,100*Math.random(),20*Math.random())},setupKeyboardControls(){this.keyboardHandler=t=>{if(this.gameRunning&&!this.gameOver)switch(t.key.toLowerCase()){case"w":case"arrowup":t.preventDefault(),"down"!==this.direction&&(this.nextDirection="up");break;case"s":case"arrowdown":t.preventDefault(),"up"!==this.direction&&(this.nextDirection="down");break;case"a":case"arrowleft":t.preventDefault(),"right"!==this.direction&&(this.nextDirection="left");break;case"d":case"arrowright":t.preventDefault(),"left"!==this.direction&&(this.nextDirection="right");break;case" ":t.preventDefault(),this.togglePause()}},document.addEventListener("keydown",this.keyboardHandler)},removeKeyboardControls(){this.keyboardHandler&&document.removeEventListener("keydown",this.keyboardHandler)},setFoodAnimationSpeed(t){this.foodAnimationSpeed=t,console.log("🍎 Food animation speed set to:",t)},setFoodEatDuration(t){this.foodEatAnimation.duration=t,console.log("🍎 Food eat animation duration set to:",t+"ms")}}},[["render",function(t,i,e,s,M,E){return o(),a("div",c,[n("canvas",{id:"gameCanvas",class:"game-canvas",width:M.canvasWidth,height:M.canvasHeight,onTouchstart:i[0]||(i[0]=(...t)=>E.onTouchStart&&E.onTouchStart(...t)),onTouchmove:i[1]||(i[1]=(...t)=>E.onTouchMove&&E.onTouchMove(...t)),onTouchend:i[2]||(i[2]=(...t)=>E.onTouchEnd&&E.onTouchEnd(...t)),onMousedown:i[3]||(i[3]=(...t)=>E.onMouseDown&&E.onMouseDown(...t)),onMousemove:i[4]||(i[4]=(...t)=>E.onMouseMove&&E.onMouseMove(...t)),onMouseup:i[5]||(i[5]=(...t)=>E.onMouseUp&&E.onMouseUp(...t))},null,40,d),n("div",l,[n("div",u,[n("span",g,h(M.score),1)]),n("div",{class:"pause-btn cyber-border",onClick:i[6]||(i[6]=(...t)=>E.togglePause&&E.togglePause(...t))},[n("span",f,h(M.isPaused?"▶":"⏸"),1)])]),M.isPaused?(o(),a("div",m,[n("div",v,[i[16]||(i[16]=n("span",{class:"pause-title cyber-text"},"游戏暂停",-1)),n("button",{class:"resume-btn cyber-button cyber-pulse",onClick:i[7]||(i[7]=(...t)=>E.togglePause&&E.togglePause(...t))},"继续游戏"),n("button",{class:"menu-btn cyber-button",onClick:i[8]||(i[8]=(...t)=>E.backToMenu&&E.backToMenu(...t))},"返回主菜单")])])):r("",!0),M.gameOver?(o(),a("div",x,[n("div",p,[i[17]||(i[17]=n("span",{class:"game-over-title cyber-text-secondary"},"游戏结束",-1)),n("span",y,h(M.score),1),n("div",b,[n("button",{class:"restart-btn cyber-button cyber-pulse",onClick:i[9]||(i[9]=(...t)=>E.restartGame&&E.restartGame(...t))}," 重新开始 "),n("button",{class:"share-btn cyber-button",onClick:i[10]||(i[10]=(...t)=>E.shareScore&&E.shareScore(...t))}," 分享得分 "),n("button",{class:"menu-btn cyber-button",onClick:i[11]||(i[11]=(...t)=>E.backToMenu&&E.backToMenu(...t))}," 返回主菜单 ")])])])):r("",!0),M.showVirtualKeys?(o(),a("div",w,[n("div",S,[n("button",{class:"control-btn up",onClick:i[12]||(i[12]=t=>E.changeDirection("up"))},"↑"),n("div",k,[n("button",{class:"control-btn left",onClick:i[13]||(i[13]=t=>E.changeDirection("left"))},"←"),n("button",{class:"control-btn right",onClick:i[14]||(i[14]=t=>E.changeDirection("right"))},"→")]),n("button",{class:"control-btn down",onClick:i[15]||(i[15]=t=>E.changeDirection("down"))},"↓")])])):r("",!0)])}],["__scopeId","data-v-7f5eb078"]]);export{M as default};
