import{a as t,l as e}from"./utils-84166b5c.js";import{_ as i,n as s}from"./main-52d6cb59.js";import{o as a,c as o,d as n,F as h,f as r,t as c,g as d,n as l}from"./vendor-e0ccc5b7.js";const g={class:"game-container"},u={class:"game-background"},f={class:"square-grid-container"},m={class:"wave-lights-container"},p=["width","height"],v={class:"game-ui"},x={class:"score-section"},y={class:"score-value"},b={class:"pause-icon"},w={key:0,class:"pause-overlay"},S={class:"pause-content"},k={key:1,class:"game-over-overlay"},M={class:"game-over-content"},E={class:"final-score"},D={class:"game-over-buttons"},T={key:2,class:"virtual-controls"},G={class:"control-pad"},A={class:"control-row"};const z=i({name:"GamePage",data:()=>({canvas:null,ctx:null,canvasWidth:800,canvasHeight:800,gameRunning:!1,isPaused:!1,gameOver:!1,score:0,gridSize:20,gameSpeed:350,snake:[{x:10,y:10},{x:9,y:10},{x:8,y:10}],direction:"right",nextDirection:"right",food:{x:15,y:15},foodAnimationSpeed:.001,foodEatAnimation:{active:!1,startTime:0,duration:100,scale:1,opacity:1},showVirtualKeys:!0,touchStartX:0,touchStartY:0,lastTime:0,gameLoop:null,particles:[],glitchEffect:!1,gridLayers:[],waveLights:[],backgroundAnimationFrame:null}),computed:{gridWidth(){return Math.floor(this.canvasWidth/this.gridSize)},gridHeight(){return Math.floor(this.canvasHeight/this.gridSize)}},mounted(){console.log("🎮 Game page loaded"),t.resume(),this.initGame(),this.setupKeyboardControls(),this.initBackgroundEffects(),this.startBackgroundAnimation(),window.setFoodAnimationSpeed=t=>this.setFoodAnimationSpeed(t),window.setFoodEatDuration=t=>this.setFoodEatDuration(t),console.log("🍎 Food animation controls available:"),console.log("  setFoodAnimationSpeed(0.001-0.02) - 调整食物旋转速度"),console.log("  setFoodEatDuration(100-1000) - 调整食物消失动画时长(ms)")},beforeUnmount(){this.stopGame(),this.removeKeyboardControls(),this.backgroundAnimationFrame&&cancelAnimationFrame(this.backgroundAnimationFrame),delete window.setFoodAnimationSpeed,delete window.setFoodEatDuration},methods:{navigateTo:s,initGame(){this.$nextTick(()=>{this.setupCanvas(),this.resetGame(),this.startGame()})},setupCanvas(){this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d");const t=.8*Math.min(window.innerWidth,window.innerHeight);this.canvasWidth=Math.min(t,600),this.canvasHeight=this.canvasWidth;const e=window.devicePixelRatio||1;this.canvas.width=this.canvasWidth*e,this.canvas.height=this.canvasHeight*e,this.canvas.style.width=this.canvasWidth+"px",this.canvas.style.height=this.canvasHeight+"px",this.ctx.scale(e,e),console.log("✅ Canvas setup completed:",this.canvasWidth+"x"+this.canvasHeight)},resetGame(){this.snake=[{x:10,y:10},{x:9,y:10},{x:8,y:10}],this.direction="right",this.nextDirection="right",this.score=0,this.gameOver=!1,this.isPaused=!1,this.generateFood(),this.particles=[],this.foodEatAnimation.active=!1,this.foodEatAnimation.scale=1,this.foodEatAnimation.opacity=1},startGame(){this.gameRunning=!0,this.lastTime=Date.now(),this.gameLoop=setInterval(this.update,this.gameSpeed),console.log("🎮 Game started")},stopGame(){this.gameRunning=!1,this.gameLoop&&(clearInterval(this.gameLoop),this.gameLoop=null)},update(){!this.gameRunning||this.isPaused||this.gameOver||(this.updateGame(),this.render())},updateGame(){this.direction=this.nextDirection,this.moveSnake(),this.checkCollisions(),this.updateParticles()},moveSnake(){const t={...this.snake[0]};switch(this.direction){case"up":t.y--;break;case"down":t.y++;break;case"left":t.x--;break;case"right":t.x++}this.snake.unshift(t),t.x===this.food.x&&t.y===this.food.y?this.eatFood():this.snake.pop()},eatFood(){this.score+=10,this.foodEatAnimation.active=!0,this.foodEatAnimation.startTime=Date.now(),this.foodEatAnimation.scale=1,this.foodEatAnimation.opacity=1,setTimeout(()=>{this.generateFood()},this.foodEatAnimation.duration),this.createEatEffect(),t.playEatSound(),this.score%50==0&&this.gameSpeed>80&&(this.gameSpeed-=10,this.stopGame(),this.startGame()),console.log("🍎 Food eaten! Score:",this.score)},generateFood(){let t;do{t={x:Math.floor(Math.random()*this.gridWidth),y:Math.floor(Math.random()*this.gridHeight)}}while(this.snake.some(e=>e.x===t.x&&e.y===t.y));this.food=t},checkCollisions(){const t=this.snake[0];if(t.x<0||t.x>=this.gridWidth||t.y<0||t.y>=this.gridHeight)this.endGame();else for(let e=1;e<this.snake.length;e++)if(t.x===this.snake[e].x&&t.y===this.snake[e].y)return void this.endGame()},endGame(){this.gameOver=!0,this.stopGame(),this.createGameOverEffect(),t.playGameOverSound();const i=e.addScore(this.score);e.isNewRecord(this.score)?(console.log("🏆 NEW HIGH SCORE!",this.score),alert("🏆 NEW HIGH SCORE!")):i<=10&&console.log(`📊 Ranked #${i} in leaderboard`),console.log("💀 Game Over! Final Score:",this.score)},render(){this.ctx&&(this.ctx.fillStyle="#001122",this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.drawGrid(),this.drawFood(),this.drawSnake(),this.drawParticles(),this.glitchEffect&&this.drawGlitch())},drawGrid(){this.ctx.strokeStyle="rgba(10, 255, 255, 0.1)",this.ctx.lineWidth=1;for(let t=0;t<=this.gridWidth;t++)this.ctx.beginPath(),this.ctx.moveTo(t*this.gridSize,0),this.ctx.lineTo(t*this.gridSize,this.canvasHeight),this.ctx.stroke();for(let t=0;t<=this.gridHeight;t++)this.ctx.beginPath(),this.ctx.moveTo(0,t*this.gridSize),this.ctx.lineTo(this.canvasWidth,t*this.gridSize),this.ctx.stroke()},drawSnake(){this.snake.forEach((t,e)=>{const i=t.x*this.gridSize,s=t.y*this.gridSize;if(0===e)this.ctx.fillStyle="#0affff",this.ctx.shadowColor="#0affff",this.ctx.shadowBlur=15,this.ctx.fillRect(i+2,s+2,this.gridSize-4,this.gridSize-4),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(i+6,s+6,this.gridSize-12,this.gridSize-12);else{const t=1-e/this.snake.length*.5;this.ctx.fillStyle=`rgba(10, 255, 255, ${t})`,this.ctx.shadowColor="#0affff",this.ctx.shadowBlur=10,this.ctx.fillRect(i+1,s+1,this.gridSize-2,this.gridSize-2)}}),this.ctx.shadowBlur=0},drawFood(){const t=this.food.x*this.gridSize,e=this.food.y*this.gridSize,i=t+this.gridSize/2,s=e+this.gridSize/2,a=Date.now()*this.foodAnimationSpeed;let o=1,n=1;if(this.foodEatAnimation.active){const t=Date.now()-this.foodEatAnimation.startTime,e=Math.min(t/this.foodEatAnimation.duration,1);if(o=e<.3?1+e/.3*.5:1.5-(e-.3)/.7*1.5,n=1-e,e>=1)return void(this.foodEatAnimation.active=!1)}this.ctx.save(),this.ctx.translate(i,s),this.ctx.rotate(a),this.ctx.scale(o,o),this.ctx.globalAlpha=n,this.ctx.fillStyle="#ff00ff",this.ctx.shadowColor="#ff00ff",this.ctx.shadowBlur=20,this.ctx.fillRect(-8,-8,16,16),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(-6,-6,12,12),this.ctx.strokeStyle="#ff00ff",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(-4,0),this.ctx.lineTo(4,0),this.ctx.moveTo(0,-4),this.ctx.lineTo(0,4),this.ctx.stroke(),this.ctx.restore(),this.ctx.shadowBlur=0},onTouchStart(t){const e=t.touches[0];this.touchStartX=e.clientX,this.touchStartY=e.clientY},onTouchMove(t){t.preventDefault()},onTouchEnd(t){if(!this.gameRunning||this.isPaused||this.gameOver)return;const e=t.changedTouches[0],i=e.clientX-this.touchStartX,s=e.clientY-this.touchStartY;Math.abs(i)>Math.abs(s)?Math.abs(i)>30&&(i>0&&"left"!==this.direction?this.nextDirection="right":i<0&&"right"!==this.direction&&(this.nextDirection="left")):Math.abs(s)>30&&(s>0&&"up"!==this.direction?this.nextDirection="down":s<0&&"down"!==this.direction&&(this.nextDirection="up"))},onMouseDown(t){this.touchStartX=t.clientX,this.touchStartY=t.clientY},onMouseMove(t){t.preventDefault()},onMouseUp(t){if(!this.gameRunning||this.isPaused||this.gameOver)return;const e=t.clientX-this.touchStartX,i=t.clientY-this.touchStartY;Math.abs(e)>Math.abs(i)?Math.abs(e)>30&&(e>0&&"left"!==this.direction?this.nextDirection="right":e<0&&"right"!==this.direction&&(this.nextDirection="left")):Math.abs(i)>30&&(i>0&&"up"!==this.direction?this.nextDirection="down":i<0&&"down"!==this.direction&&(this.nextDirection="up"))},changeDirection(t){if(!this.gameRunning||this.isPaused||this.gameOver)return;this.direction!=={up:"down",down:"up",left:"right",right:"left"}[t]&&(this.nextDirection=t)},togglePause(){this.isPaused=!this.isPaused,console.log(this.isPaused?"⏸ Game paused":"▶ Game resumed")},restartGame(){this.stopGame(),this.resetGame(),this.startGame()},backToMenu(){this.stopGame(),this.navigateTo("index")},shareScore(){const t=`我在CyberSnake中获得了${this.score}分！\nI AM THE SYSTEM`;navigator.share?navigator.share({title:"CyberSnake Score",text:t,url:window.location.href}).catch(t=>console.log("Share failed:",t)):navigator.clipboard.writeText(t+"\n"+window.location.href).then(()=>alert("分数已复制到剪贴板！")).catch(()=>alert(`我的分数：${this.score}分`))},createEatEffect(){const t=this.food.x*this.gridSize+this.gridSize/2,e=this.food.y*this.gridSize+this.gridSize/2;for(let i=0;i<8;i++)this.particles.push({x:t,y:e,vx:10*(Math.random()-.5),vy:10*(Math.random()-.5),life:1,decay:.02,color:"#ff00ff",size:3+3*Math.random()});this.glitchEffect=!0,setTimeout(()=>{this.glitchEffect=!1},100)},createGameOverEffect(){for(let t=0;t<20;t++)this.particles.push({x:Math.random()*this.canvasWidth,y:Math.random()*this.canvasHeight,vx:15*(Math.random()-.5),vy:15*(Math.random()-.5),life:1,decay:.01,color:Math.random()>.5?"#0affff":"#ff00ff",size:4+6*Math.random()})},updateParticles(){this.particles=this.particles.filter(t=>(t.x+=t.vx,t.y+=t.vy,t.life-=t.decay,t.vx*=.98,t.vy*=.98,t.life>0))},drawParticles(){this.particles.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=t.life,this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill(),this.ctx.restore()})},drawGlitch(){for(let t=0;t<5;t++)this.ctx.fillStyle="rgba(255, 0, 255, 0.1)",this.ctx.fillRect(Math.random()*this.canvasWidth,Math.random()*this.canvasHeight,100*Math.random(),20*Math.random())},setupKeyboardControls(){this.keyboardHandler=t=>{if(this.gameRunning&&!this.gameOver)switch(t.key.toLowerCase()){case"w":case"arrowup":t.preventDefault(),"down"!==this.direction&&(this.nextDirection="up");break;case"s":case"arrowdown":t.preventDefault(),"up"!==this.direction&&(this.nextDirection="down");break;case"a":case"arrowleft":t.preventDefault(),"right"!==this.direction&&(this.nextDirection="left");break;case"d":case"arrowright":t.preventDefault(),"left"!==this.direction&&(this.nextDirection="right");break;case" ":t.preventDefault(),this.togglePause()}},document.addEventListener("keydown",this.keyboardHandler)},removeKeyboardControls(){this.keyboardHandler&&document.removeEventListener("keydown",this.keyboardHandler)},setFoodAnimationSpeed(t){this.foodAnimationSpeed=t,console.log("🍎 Food animation speed set to:",t)},setFoodEatDuration(t){this.foodEatAnimation.duration=t,console.log("🍎 Food eat animation duration set to:",t+"ms")},initBackgroundEffects(){this.gridLayers=[];for(let t=0;t<4;t++){const e={id:t,size:40+20*t,opacity:.08-.015*t,speed:.3+.2*t,offsetX:0,offsetY:0,style:{}};this.gridLayers.push(e)}this.waveLights=[];for(let t=0;t<6;t++){const e={id:t,direction:t%2==0?"horizontal":"vertical",position:t/6*100,width:150+100*Math.random(),speed:.5+1*Math.random(),opacity:.1+.15*Math.random(),phase:Math.random()*Math.PI*2,style:{}};this.waveLights.push(e)}},startBackgroundAnimation(){const t=()=>{const e=.001*Date.now();this.gridLayers.forEach((t,i)=>{t.offsetX=5*Math.sin(e*t.speed*.3),t.offsetY=3*Math.cos(e*t.speed*.2);const s=.02*Math.sin(e*t.speed+i),a=Math.max(0,t.opacity+s);t.style={position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`\n              linear-gradient(rgba(10, 255, 255, ${a}) 1px, transparent 1px),\n              linear-gradient(90deg, rgba(10, 255, 255, ${a}) 1px, transparent 1px)\n            `,backgroundSize:`${t.size}px ${t.size}px`,transform:`translate(${t.offsetX}px, ${t.offsetY}px)`,pointerEvents:"none"}}),this.waveLights.forEach((t,i)=>{const s=e*t.speed+t.phase,a=.5*(Math.sin(s)+1),o=t.opacity*a;if("horizontal"===t.direction){const e=t.position+20*Math.sin(.5*s);t.style={position:"absolute",left:"0",top:`${e}%`,width:"100%",height:`${t.width}px`,background:`linear-gradient(90deg,\n                transparent 0%,\n                rgba(10, 255, 255, ${.3*o}) 25%,\n                rgba(10, 255, 255, ${o}) 50%,\n                rgba(10, 255, 255, ${.3*o}) 75%,\n                transparent 100%)`,transform:`translateX(${50*Math.sin(.8*s)}px)`,pointerEvents:"none",filter:"blur(2px)"}}else{const e=t.position+15*Math.cos(.4*s);t.style={position:"absolute",left:`${e}%`,top:"0",width:`${t.width}px`,height:"100%",background:`linear-gradient(180deg,\n                transparent 0%,\n                rgba(10, 255, 255, ${.3*o}) 25%,\n                rgba(10, 255, 255, ${o}) 50%,\n                rgba(10, 255, 255, ${.3*o}) 75%,\n                transparent 100%)`,transform:`translateY(${30*Math.cos(.6*s)}px)`,pointerEvents:"none",filter:"blur(2px)"}}}),this.backgroundAnimationFrame=requestAnimationFrame(t)};t()}}},[["render",function(t,e,i,s,z,C){return a(),o("div",g,[n("div",u,[n("div",f,[(a(!0),o(h,null,r(z.gridLayers,t=>(a(),o("div",{class:"square-grid-layer",key:t.id,style:l(t.style)},null,4))),128))]),n("div",m,[(a(!0),o(h,null,r(z.waveLights,t=>(a(),o("div",{class:"wave-light",key:t.id,style:l(t.style)},null,4))),128))])]),n("canvas",{id:"gameCanvas",class:"game-canvas",width:z.canvasWidth,height:z.canvasHeight,onTouchstart:e[0]||(e[0]=(...t)=>C.onTouchStart&&C.onTouchStart(...t)),onTouchmove:e[1]||(e[1]=(...t)=>C.onTouchMove&&C.onTouchMove(...t)),onTouchend:e[2]||(e[2]=(...t)=>C.onTouchEnd&&C.onTouchEnd(...t)),onMousedown:e[3]||(e[3]=(...t)=>C.onMouseDown&&C.onMouseDown(...t)),onMousemove:e[4]||(e[4]=(...t)=>C.onMouseMove&&C.onMouseMove(...t)),onMouseup:e[5]||(e[5]=(...t)=>C.onMouseUp&&C.onMouseUp(...t))},null,40,p),n("div",v,[n("div",x,[n("span",y,c(z.score),1)]),n("div",{class:"pause-btn cyber-border",onClick:e[6]||(e[6]=(...t)=>C.togglePause&&C.togglePause(...t))},[n("span",b,c(z.isPaused?"▶":"⏸"),1)])]),z.isPaused?(a(),o("div",w,[n("div",S,[e[16]||(e[16]=n("span",{class:"pause-title cyber-text"},"游戏暂停",-1)),n("button",{class:"resume-btn cyber-button cyber-pulse",onClick:e[7]||(e[7]=(...t)=>C.togglePause&&C.togglePause(...t))},"继续游戏"),n("button",{class:"menu-btn cyber-button",onClick:e[8]||(e[8]=(...t)=>C.backToMenu&&C.backToMenu(...t))},"返回主菜单")])])):d("",!0),z.gameOver?(a(),o("div",k,[n("div",M,[e[17]||(e[17]=n("span",{class:"game-over-title cyber-text-secondary"},"游戏结束",-1)),n("span",E,c(z.score),1),n("div",D,[n("button",{class:"restart-btn cyber-button cyber-pulse",onClick:e[9]||(e[9]=(...t)=>C.restartGame&&C.restartGame(...t))}," 重新开始 "),n("button",{class:"share-btn cyber-button",onClick:e[10]||(e[10]=(...t)=>C.shareScore&&C.shareScore(...t))}," 分享得分 "),n("button",{class:"menu-btn cyber-button",onClick:e[11]||(e[11]=(...t)=>C.backToMenu&&C.backToMenu(...t))}," 返回主菜单 ")])])])):d("",!0),z.showVirtualKeys?(a(),o("div",T,[n("div",G,[n("button",{class:"control-btn up",onClick:e[12]||(e[12]=t=>C.changeDirection("up"))},"↑"),n("div",A,[n("button",{class:"control-btn left",onClick:e[13]||(e[13]=t=>C.changeDirection("left"))},"←"),n("button",{class:"control-btn right",onClick:e[14]||(e[14]=t=>C.changeDirection("right"))},"→")]),n("button",{class:"control-btn down",onClick:e[15]||(e[15]=t=>C.changeDirection("down"))},"↓")])])):d("",!0)])}],["__scopeId","data-v-aec87e3d"]]);export{z as default};
